<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.16"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>PcapPlusPlus: KniDevice.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-mobile.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo_icon_large.ico"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">PcapPlusPlus
   &#160;<span id="projectnumber">19.12</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.16 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('_kni_device_8h.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#namespaces">Namespaces</a> &#124;
<a href="#typedef-members">Typedefs</a>  </div>
  <div class="headertitle">
<div class="title">KniDevice.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>This file and <a class="el" href="_kni_device_list_8h_source.html">KniDeviceList.h</a> provide PcapPlusPlus C++ wrapper for DPDK KNI (Kernel Network Interace) library (librte_kni). The main propose of the rte_kni library is to provide a way to forward packets received by DPDK application to Linux kernel (a.e. to processes that have opened some kind of a net socket) for further processing and to obtain packets from Linux kernel. The KNI device is the bridge that accomplish the translation between DPDK packets (mbuf) and Linux kernel/socket packets (skbuf). Currently KNI devices report speeds upto 10 GBit/s.<br  />
 KNI device is a virtual network interface so it can be created and destroyed programmatically at will. As a real network interface KNI deivice must be managed appropriately like other interfaces. To start operate it MUST be given an IP address for example by the means of <b>ip a</b> command and MUST be put up for example by <b>ip l set [interface] up</b>.<br  />
 Additionally KNI interfaces support 4 other settings (depends on DPDK version used):  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;string&gt;</code><br />
<code>#include &quot;<a class="el" href="_device_8h_source.html">Device.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_mac_address_8h_source.html">MacAddress.h</a>&quot;</code><br />
<code>#include &quot;MBufRawPacket.h&quot;</code><br />
<code>#include &quot;LinuxNicInformationSocket.h&quot;</code><br />
</div>
<p><a href="_kni_device_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classpcpp_1_1_kni_device.html">pcpp::KniDevice</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structpcpp_1_1_kni_device_1_1_kni_ioctl_callbacks.html">pcpp::KniDevice::KniIoctlCallbacks</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">New callbacks for KNI device events. This structure MUST be used ONLY when <a class="el" href="classpcpp_1_1_kni_device_list.html#afa8b65d977557e02a19e87139e1fbcc0">KniDeviceList::callbackVersion</a> returns KniDeviceList::KniCallbackVersion::CALLBACKS_NEW. Or if You are sure that DPDK version used is 17.11 or higher. If some callback is not provided (NULL) the request will always succeeds if other is not specified in callback description.  <a href="structpcpp_1_1_kni_device_1_1_kni_ioctl_callbacks.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structpcpp_1_1_kni_device_1_1_kni_old_ioctl_callbacks.html">pcpp::KniDevice::KniOldIoctlCallbacks</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Old callbacks for KNI device events. This structure MUST be used ONLY when <a class="el" href="classpcpp_1_1_kni_device_list.html#afa8b65d977557e02a19e87139e1fbcc0">KniDeviceList::callbackVersion</a> returns KniDeviceList::KniCallbackVersion::CALLBACKS_OLD. Or if You are sure that DPDK version used is lower than 17.11. If some callback is not provided (NULL) the request will always succeeds.  <a href="structpcpp_1_1_kni_device_1_1_kni_old_ioctl_callbacks.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structpcpp_1_1_kni_device_1_1_kni_device_configuration.html">pcpp::KniDevice::KniDeviceConfiguration</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">KNI device initialization data. Used to create new KNI device. Usage of callbacks member or oldCallbacks member is defined by result of <a class="el" href="classpcpp_1_1_kni_device_list.html#afa8b65d977557e02a19e87139e1fbcc0">KniDeviceList::callbackVersion</a>.  <a href="structpcpp_1_1_kni_device_1_1_kni_device_configuration.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="namespaces"></a>
Namespaces</h2></td></tr>
<tr class="memitem:namespacepcpp"><td class="memItemLeft" align="right" valign="top"> &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacepcpp.html">pcpp</a></td></tr>
<tr class="memdesc:namespacepcpp"><td class="mdescLeft">&#160;</td><td class="mdescRight">The main namespace for the PcapPlusPlus lib. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:a5d5c27837ffd86e49a6b4ce2cc1ed57b"><td class="memItemLeft" align="right" valign="top">typedef bool(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacepcpp.html#a5d5c27837ffd86e49a6b4ce2cc1ed57b">pcpp::OnKniPacketArriveCallback</a>) (MBufRawPacket *packets, uint32_t numOfPackets, KniDevice *device, void *userCookie)</td></tr>
<tr class="separator:a5d5c27837ffd86e49a6b4ce2cc1ed57b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>This file and <a class="el" href="_kni_device_list_8h_source.html">KniDeviceList.h</a> provide PcapPlusPlus C++ wrapper for DPDK KNI (Kernel Network Interace) library (librte_kni). The main propose of the rte_kni library is to provide a way to forward packets received by DPDK application to Linux kernel (a.e. to processes that have opened some kind of a net socket) for further processing and to obtain packets from Linux kernel. The KNI device is the bridge that accomplish the translation between DPDK packets (mbuf) and Linux kernel/socket packets (skbuf). Currently KNI devices report speeds upto 10 GBit/s.<br  />
 KNI device is a virtual network interface so it can be created and destroyed programmatically at will. As a real network interface KNI deivice must be managed appropriately like other interfaces. To start operate it MUST be given an IP address for example by the means of <b>ip a</b> command and MUST be put up for example by <b>ip l set [interface] up</b>.<br  />
 Additionally KNI interfaces support 4 other settings (depends on DPDK version used): </p>
<ul>
<li>change link state: <b>ip l set [interface] up/down</b></li>
<li>change MTU: <b>ip l set dev [interface] mtu [mtu_count]</b></li>
<li>change MAC address: <b>ip l set [interface] address [new_mac]</b></li>
<li>change promiscuous mode: <b>ip l set [interface] promisc on/off</b></li>
</ul>
<p>Changes of each of this settings generates an event/request that must be handled by an application that have created the KNI device in 3 second period or it will be rejected and Linux kernel will not apply the change. The way that this requests MUST be handeled is defined by DPDK and so for each type of request the application tht creates the KNI device must provide the callback function to call. This callbacks are set in time of KNI device creation via KniIoctlCallbacks or KniOldIoctlCallbacks structures (the structure used is dependent on DPDK version).<br  />
 There is a way to enable <b>ethtool</b> on KNI devices that include recompilation of DPDK and strict correspondence between KNI port id and DPDK port id, but it is not currently supported by PcapPlusPlus.<br  />
</p>
<p>Known issues:</p><ul>
<li>KNI device may not be able to set/update it's link status up (LINK_ERROR returned): The problem is laying in DPDK in rte_kni_update_link function (it is DPDK BUG if rte_kni_update_link is __rte_experimental). It is recommended to load rte_kni.ko module with "carrier=on" DPDK default is "carrier=off", provided setup-dpdk.sh by default loads with "carrier=on" if Your DPDK version supports it. The good indication of this issue are "DPDK KNI Failed to update links state for device" messages when Pcap++Test application is being run.</li>
<li>Packets may not be seen by applications that have open sockets on KNI device: Check your <b>iptables</b> settings and other packet filters - KNI device is traditional network device so all caveats apply;</li>
<li>I see a lot of unknown traffic - what is it? This must be Linux kernel trying to communicate with other devices from KNI device and it will do so as long as You give the KNI device any IP address via ip command or by record in /etc/networking/interfaces;</li>
<li>On old versions of DPDK only 4 KNI devices may be created: Yep this is a limitation. You can change MAX_KNI_DEVICES constant in KniDeviceList.cpp to unlock this limit;</li>
<li>Any set* method never succeeds: You may forgot that they generate KNI requests that Your application MUST handle. Just use KniDevice::startRequestHandlerThread to handle all requests automatically. Or user running the application don't have suitable access rights (must have CAP_NET_ADMIN).</li>
</ul>
<p>Usefull links:</p><ul>
<li><a href="https://doc.dpdk.org/guides/prog_guide/kernel_nic_interface.html">KNI interface concept DPDK documentation</a></li>
<li><a href="https://doc.dpdk.org/guides/nics/kni.html">KNI PMD</a></li>
<li><a href="https://doc.dpdk.org/guides/sample_app_ug/kernel_nic_interface.html">KNI DPDK sample application</a></li>
<li><a href="https://doc.dpdk.org/dts/test_plans/kni_test_plan.html">KNI DPDK test plan</a> </li>
</ul>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_de86beb0baec615108c189a95e2985e8.html">PcapPlusPlus</a></li><li class="navelem"><a class="el" href="dir_5651890ad0082dbf4dbb18c410c015c9.html">Dist</a></li><li class="navelem"><a class="el" href="dir_00034babc01e96e2748c521d6645ae1d.html">header</a></li><li class="navelem"><a class="el" href="_kni_device_8h.html">KniDevice.h</a></li>
    <li class="footer">Generated on Mon Dec 2 2019 23:53:21 for PcapPlusPlus by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.16 </li>
  </ul>
</div>
</body>
</html>
